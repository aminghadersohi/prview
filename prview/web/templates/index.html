{% extends "base.html" %}

{% block extra_head %}
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10/dist/ext/sse.js"></script>
{% endblock %}

{% block body_attrs %}hx-ext="sse" sse-connect="/events"{% endblock %}

{% block header_right %}
    <div class="status-bar">
        <div id="sync-status" hx-get="/partials/status" hx-trigger="sse:update" hx-swap="innerHTML">
            {% include "partials/status.html" %}
        </div>
        <button class="btn" hx-post="/sync" hx-swap="none">
            <span>&#x21bb;</span> Refresh
        </button>
        <a href="/chat" class="btn" title="Chat with Claude">
            <span>&#x1F4AC;</span>
        </a>
        <a href="/settings" class="btn" title="Settings">
            <span>&#x2699;&#xFE0F;</span>
        </a>
    </div>
{% endblock %}

{% block content %}
    <!-- Legend -->
    <div class="legend">
        <div class="legend-group">
            <span class="legend-label">CI:</span>
            <span class="legend-item"><span class="status-icon success">&#x2713;</span> pass</span>
            <span class="legend-item"><span class="status-icon failure">&#x2717;</span> fail</span>
            <span class="legend-item"><span class="status-icon pending">&#x25D0;</span> running</span>
            <span class="legend-item"><span class="status-icon none">&#x25CB;</span> none</span>
        </div>
        <div class="legend-group">
            <span class="legend-label">Review:</span>
            <span class="legend-item"><span class="status-icon success">&#x2713;</span> approved</span>
            <span class="legend-item"><span class="status-icon failure">&#x2717;</span> changes</span>
            <span class="legend-item"><span class="status-icon pending">&#x25CF;</span> required</span>
            <span class="legend-item"><span class="status-icon none">&#x25CB;</span> pending</span>
        </div>
    </div>

    <!-- PR content -->
    <div id="pr-content" hx-get="/partials/prs" hx-trigger="sse:update" hx-swap="innerHTML">
        {% include "partials/prs.html" %}
    </div>

    <div class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>
{% endblock %}
